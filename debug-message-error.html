<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>$message 错误诊断工具</title>
    <style>
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        margin: 0;
        padding: 20px;
        background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
        min-height: 100vh;
        color: #333;
      }

      .diagnostic-container {
        max-width: 900px;
        margin: 0 auto;
        background: rgba(255, 255, 255, 0.95);
        border-radius: 20px;
        padding: 30px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      }

      h1 {
        color: #dc2626;
        text-align: center;
        margin-bottom: 30px;
        font-size: 28px;
      }

      .error-info {
        background: #fef2f2;
        border: 2px solid #dc2626;
        border-radius: 12px;
        padding: 20px;
        margin: 20px 0;
      }

      .error-title {
        color: #dc2626;
        font-weight: bold;
        font-size: 18px;
        margin-bottom: 10px;
      }

      .diagnostic-section {
        background: #f0f9ff;
        border: 2px solid #0ea5e9;
        border-radius: 12px;
        padding: 20px;
        margin: 20px 0;
      }

      .diagnostic-title {
        color: #0ea5e9;
        font-weight: bold;
        font-size: 18px;
        margin-bottom: 15px;
      }

      .solution-section {
        background: #f0fdf4;
        border: 2px solid #16a34a;
        border-radius: 12px;
        padding: 20px;
        margin: 20px 0;
      }

      .solution-title {
        color: #16a34a;
        font-weight: bold;
        font-size: 18px;
        margin-bottom: 15px;
      }

      .code-block {
        background: #1e293b;
        color: #e2e8f0;
        padding: 15px;
        border-radius: 8px;
        font-family: "Monaco", "Menlo", "Ubuntu Mono", monospace;
        font-size: 14px;
        overflow-x: auto;
        margin: 10px 0;
      }

      .step {
        margin: 10px 0;
        padding: 15px;
        border-left: 4px solid #4f46e5;
        background: #f8fafc;
        border-radius: 0 8px 8px 0;
      }

      .warning {
        background: #fef3c7;
        border: 2px solid #f59e0b;
        color: #d97706;
        padding: 15px;
        border-radius: 8px;
        margin: 10px 0;
      }

      .highlight {
        background: #fbbf24;
        padding: 2px 6px;
        border-radius: 4px;
        font-weight: bold;
      }

      ul {
        padding-left: 20px;
      }

      li {
        margin: 8px 0;
        line-height: 1.6;
      }

      .debug-script {
        background: #1e1e2e;
        color: #cdd6f4;
        padding: 20px;
        border-radius: 12px;
        font-family: "Monaco", "Menlo", "Ubuntu Mono", monospace;
        font-size: 13px;
        margin: 15px 0;
        border: 2px solid #6c7086;
      }
    </style>
  </head>
  <body>
    <div class="diagnostic-container">
      <h1>🔍 TypeError: this.$message is not a function 诊断工具</h1>

      <div class="error-info">
        <div class="error-title">🚨 错误详情</div>
        <p>
          <strong>错误类型：</strong> TypeError: this.$message is not a function
        </p>
        <p><strong>发生位置：</strong> bookmark.html</p>
        <p>
          <strong>影响范围：</strong> Arco Design Vue组件中的Message全局方法调用
        </p>
        <p>
          <strong>症状：</strong> 组件中使用
          this.$message.success()、this.$message.error() 等方法时报错
        </p>
      </div>

      <div class="diagnostic-section">
        <div class="diagnostic-title">🔍 可能原因分析</div>

        <h3>1. 时机问题（最可能）</h3>
        <ul>
          <li>组件在Vue实例完全初始化前调用$message</li>
          <li>异步操作中丢失了Vue实例的上下文</li>
          <li>在某些生命周期钩子中过早调用</li>
        </ul>

        <h3>2. 上下文丢失</h3>
        <ul>
          <li>在回调函数、Promise、setTimeout中使用this.$message</li>
          <li>箭头函数 vs 普通函数的上下文差异</li>
          <li>事件处理器中的this绑定问题</li>
        </ul>

        <h3>3. 配置问题</h3>
        <ul>
          <li>Vue实例创建时机与组件挂载的竞争条件</li>
          <li>HMR热重载导致的状态不一致</li>
          <li>多个Vue实例之间的配置冲突</li>
        </ul>
      </div>

      <div class="solution-section">
        <div class="solution-title">💡 解决方案</div>

        <h3>方案1: 添加安全检查（推荐）</h3>
        <div class="step">
          在所有使用 $message 的地方添加安全检查：
          <div class="code-block">
            // 原来的代码 this.$message.success("操作成功"); // 修改为安全版本
            if (this.$message) { this.$message.success("操作成功"); } else {
            console.log("操作成功"); // 降级处理 } // 或者使用可选链（推荐）
            this.$message?.success?.("操作成功");
          </div>
        </div>

        <h3>方案2: 直接导入使用</h3>
        <div class="step">
          在组件中直接导入Message组件，不依赖全局属性：
          <div class="code-block">
            // 在组件的 script 部分添加 import { Message } from
            '@arco-design/web-vue'; // 然后直接使用 Message.success("操作成功");
            Message.error("操作失败");
          </div>
        </div>

        <h3>方案3: 增强型全局配置</h3>
        <div class="step">
          在 main.js 中添加更robust的配置：
          <div class="code-block">
            import { createApp } from 'vue'; import App from './App.vue'; import
            ArcoVue from '@arco-design/web-vue'; import { Message } from
            '@arco-design/web-vue'; const app = createApp(App);
            app.use(ArcoVue); // 增强型配置 app.config.globalProperties.$message
            = Message; // 添加备用方法 app.config.globalProperties.$safeMessage
            = { success: (msg) => Message?.success?.(msg) ||
            console.log('SUCCESS:', msg), error: (msg) => Message?.error?.(msg)
            || console.error('ERROR:', msg), warning: (msg) =>
            Message?.warning?.(msg) || console.warn('WARNING:', msg), info:
            (msg) => Message?.info?.(msg) || console.info('INFO:', msg) };
            app.mount('#app');
          </div>
        </div>
      </div>

      <div class="diagnostic-section">
        <div class="diagnostic-title">🛠️ 调试脚本</div>
        <p>在浏览器控制台中运行以下脚本来诊断问题：</p>

        <div class="debug-script">
          // 检查Vue实例和$message配置 console.log('=== $message 诊断报告 ===');
          console.log('1. 检查Vue实例:', window.Vue || 'Vue未找到');
          console.log('2. 检查当前Vue应用:',
          document.querySelector('#app')?.__vue_app__ || '应用实例未找到'); //
          检查全局属性 const app = document.querySelector('#app'); if (app &&
          app.__vue_app__) { const globalProps =
          app.__vue_app__.config.globalProperties; console.log('3.
          全局属性中的$message:', globalProps.$message || '未找到');
          console.log('4. Message类型:', typeof globalProps.$message);
          console.log('5. Message方法:', globalProps.$message ?
          Object.keys(globalProps.$message) : '无'); } // 检查Arco Design
          console.log('6. Arco Design Vue:', window.ArcoVue || '未加载'); //
          测试Message方法 try { const { Message } =
          require('@arco-design/web-vue'); console.log('7.
          直接导入Message测试:', typeof Message); Message.info('诊断测试消息');
          } catch (e) { console.log('7. 直接导入Message失败:', e.message); }
          console.log('=== 诊断完成 ===');
        </div>
      </div>

      <div class="warning">
        <strong>⚠️ 临时解决方案：</strong>
        如果问题仍然存在，可以在出错的组件中临时添加：
        <div
          class="code-block"
          style="margin-top: 10px; background: #4b5563; color: #f9fafb"
        >
          mounted() { // 确保 $message 可用 if (!this.$message) {
          console.warn('$message not available, setting up fallback');
          this.$message = { success: (msg) => console.log('SUCCESS:', msg),
          error: (msg) => console.error('ERROR:', msg), warning: (msg) =>
          console.warn('WARNING:', msg), info: (msg) => console.info('INFO:',
          msg) }; } }
        </div>
      </div>

      <div style="text-align: center; margin-top: 40px; color: #6b7280">
        <p>📋 如果问题持续存在，请提供具体的错误堆栈信息和触发场景</p>
        <p style="font-size: 12px">
          LinuxDo Scripts - $message 错误诊断工具 v2025.09.15
        </p>
      </div>
    </div>
  </body>
</html>
